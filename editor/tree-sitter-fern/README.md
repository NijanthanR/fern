# Tree-sitter Grammar for Fern

**IMPORTANT: This grammar is AUTO-GENERATED from the Fern compiler source code.**

Do not edit `grammar.js` manually - it will be overwritten by the generator script.

## Generation

The grammar is generated from the compiler's token definitions:

```bash
# From the fern project root:
make editor-support  # Generates grammar.js
```

## Compilation

To compile the grammar to WASM for use in editors:

### One-time setup

```bash
npm install -g tree-sitter-cli
```

### Compile to WASM

```bash
# From the fern project root:
make editor-support-compile
```

This will:
1. Generate `grammar.js` from `include/token.h`
2. Run `tree-sitter generate` to create the parser
3. Run `tree-sitter build --wasm` to compile to WASM
4. Copy `tree-sitter-fern.wasm` to the Zed extension

## Manual Compilation

If you need to compile manually:

```bash
cd editor/tree-sitter-fern
tree-sitter generate              # Generate parser from grammar.js
tree-sitter build --wasm          # Compile to WASM
cp tree-sitter-fern.wasm ../zed-fern/languages/fern/fern.wasm
```

## Testing the Grammar

```bash
cd editor/tree-sitter-fern
tree-sitter generate
tree-sitter test          # Run tests (if any)
tree-sitter parse ../../examples/hello.fn  # Test on example file
```

## How It Works

The grammar is generated by `scripts/generate_editor_support.py`:

1. Reads token definitions from `include/token.h`
2. Maps tokens to Tree-sitter grammar rules
3. Generates `grammar.js` with:
   - Expression precedence (pipe `|>` lowest, `**` highest)
   - Pattern matching syntax
   - Type annotations
   - String interpolation
   - Function definitions

## Source of Truth

The **Fern compiler** is the source of truth for the language grammar. This Tree-sitter grammar is derived from it to ensure consistency.

If the grammar doesn't match the language behavior, update `scripts/generate_editor_support.py`, not this file.
